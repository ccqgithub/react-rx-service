import{BehaviorSubject as e,Subject as t}from"rxjs";import r,{createContext as o,useContext as s,forwardRef as n,useState as i,useCallback as c,useEffect as a}from"react";const u={logLevel:"error",log:(e,t="info")=>{console&&console[t]&&console[t](e)}},f=e=>{Object.keys(e).forEach((t=>{t in u&&void 0!==e[t]&&(u[t]=e[t])}))},l=(e,t="info",r=!0)=>{if(!r)return;const o=["info","warn","error","never"];o.indexOf(u.logLevel)>o.indexOf(t)||u.log(e,t)},p=Symbol("empty");class y{constructor(){this.$_disposers=[]}beforeDispose(e){this.$_disposers.push(e)}dispose(){this.$_disposers.forEach((e=>{e()}))}}class d{constructor(e,t){this._desc=e,this.factory=t?.factory}toString(){return`InjectionToken: ${this._desc}`}}class h{constructor(e=[],t=null){this.parent=null,this.records=new Map,this.parent=t,e.forEach((e=>{let t=null;if("object"==typeof e){const r=e,o=["useValue","useClass","useExisiting","useFactory"];let s=0;o.forEach((e=>{void 0!==r[e]&&s++})),s>1&&l(`These keys [${o.join(",")}] can only use one, other will be ignored!`,"warn");const{useValue:n,...i}=r;t={...i,value:n}}else if("function"==typeof e&&"function"==typeof e.prototype.constructor){t={provide:e,useClass:e}}if(!t)throw l(e),new Error("Error provider onfig!");if(!(void 0!==t.value||t.useClass||t.useExisiting||t.useFactory||t.provide instanceof d&&t.useFactory))throw l(e),new Error("Error provider onfig!");this.records.set(t.provide,t)}))}isProvided(e){return!!this.records.has(e)||!!this.parent&&this.parent.isProvided(e)}get(e,t){const r=this.records.get(e);let o=null;if(r?(void 0===r.value&&this.$_initRecord(r),o=r.value||null):this.parent&&(o=this.parent.get(e,t)),!o&&!t?.optional)throw new Error("Service not be provided, and not optional!");return o}$_initRecord(e){const t={useService:(e,t)=>this.get(e,t)};e.provide instanceof d&&e.provide.factory&&(e.value=e.provide.factory(t)),e.useClass?e.value=new e.useClass(t):e.useExisiting?e.value=this.get(e.useExisiting):e.useFactory&&(e.value=e.useFactory(t))}dispose(){for(const[,e]of this.records){if(!e.value)return;e.dispose?e.dispose(e.value):"function"==typeof e.value.dispose&&e.value.dispose()}this.parent=null,this.records.clear()}}class b extends y{constructor(r={}){super(),this.displayName="",this.$$={},this.$={},this.$e={};const o=r.state||{};Object.keys(o).forEach((t=>{this.$$[t]=new e(o[t])}));(r.actions||[]).forEach((e=>{this.$[e]=new t}));(r.events||[]).forEach((e=>{this.$e[e]=new t})),Object.keys(this.$$).forEach((e=>{this.subscribe(this.$$[e],{next:t=>{l(`[Service ${this.displayName}]: set new state [${e}].`,"info"),l(t,"info")}})})),Object.keys(this.$).forEach((e=>{this.subscribe(this.$[e],{next:t=>{l(`[Service ${this.displayName}]: receive new action [${e}].`,"info"),l(t,"info")}})})),Object.keys(this.$e).forEach((e=>{this.subscribe(this.$e[e],{next:t=>{l(`[Service ${this.displayName}]: emit new event [${e}].`,"info"),l(t,"info")}})}))}get state(){const t={};return Object.keys(this.$$).forEach((r=>{const o=this.$$[r];o instanceof e&&(t[r]=o.value)})),t}subscribe(e,...t){const r=e.subscribe(...t);this.beforeDispose((()=>{r.unsubscribe()}))}}
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var m="function"==typeof Symbol&&Symbol.for,v=m?Symbol.for("react.element"):60103,$=m?Symbol.for("react.portal"):60106,S=m?Symbol.for("react.fragment"):60107,g=m?Symbol.for("react.strict_mode"):60108,w=m?Symbol.for("react.profiler"):60114,E=m?Symbol.for("react.provider"):60109,x=m?Symbol.for("react.context"):60110,j=m?Symbol.for("react.async_mode"):60111,O=m?Symbol.for("react.concurrent_mode"):60111,P=m?Symbol.for("react.forward_ref"):60112,C=m?Symbol.for("react.suspense"):60113,F=m?Symbol.for("react.suspense_list"):60120,_=m?Symbol.for("react.memo"):60115,M=m?Symbol.for("react.lazy"):60116,N=m?Symbol.for("react.block"):60121,T=m?Symbol.for("react.fundamental"):60117,k=m?Symbol.for("react.responder"):60118,D=m?Symbol.for("react.scope"):60119;function R(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case v:switch(e=e.type){case j:case O:case S:case w:case g:case C:return e;default:switch(e=e&&e.$$typeof){case x:case P:case M:case _:case E:return e;default:return t}}case $:return t}}}function L(e){return R(e)===O}var V,z={AsyncMode:j,ConcurrentMode:O,ContextConsumer:x,ContextProvider:E,Element:v,ForwardRef:P,Fragment:S,Lazy:M,Memo:_,Portal:$,Profiler:w,StrictMode:g,Suspense:C,isAsyncMode:function(e){return L(e)||R(e)===j},isConcurrentMode:L,isContextConsumer:function(e){return R(e)===x},isContextProvider:function(e){return R(e)===E},isElement:function(e){return"object"==typeof e&&null!==e&&e.$$typeof===v},isForwardRef:function(e){return R(e)===P},isFragment:function(e){return R(e)===S},isLazy:function(e){return R(e)===M},isMemo:function(e){return R(e)===_},isPortal:function(e){return R(e)===$},isProfiler:function(e){return R(e)===w},isStrictMode:function(e){return R(e)===g},isSuspense:function(e){return R(e)===C},isValidElementType:function(e){return"string"==typeof e||"function"==typeof e||e===S||e===O||e===w||e===g||e===C||e===F||"object"==typeof e&&null!==e&&(e.$$typeof===M||e.$$typeof===_||e.$$typeof===E||e.$$typeof===x||e.$$typeof===P||e.$$typeof===T||e.$$typeof===k||e.$$typeof===D||e.$$typeof===N)},typeOf:R},A=(function(e){e.exports=z}(V={exports:{}},V.exports),V.exports),B={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},I={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},q={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},G={};function H(e){return A.isMemo(e)?q:G[e.$$typeof]||B}G[A.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},G[A.Memo]=q;var J=Object.defineProperty,K=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,U=Object.getOwnPropertyDescriptor,W=Object.getPrototypeOf,X=Object.prototype;var Y=function e(t,r,o){if("string"!=typeof r){if(X){var s=W(r);s&&s!==X&&e(t,s,o)}var n=K(r);Q&&(n=n.concat(Q(r)));for(var i=H(t),c=H(r),a=0;a<n.length;++a){var u=n[a];if(!(I[u]||o&&o[u]||c&&c[u]||i&&i[u])){var f=U(r,u);try{J(t,u,f)}catch(S){}}}}return t};const Z=o(new h),ee=e=>{const t=s(Z),{providers:o=[],children:n}=e,i=new h(o,t);return r.createElement(Z.Provider,{value:i},n)},te=e=>{const t=s(Z);return"function"==typeof e.children?e.children({getService:(e,r)=>t.get(e,r)}):e.children},re=e=>t=>{const o="withInjector("+(t.displayName||t.name)+")",s=n(((o,s)=>r.createElement(ee,{providers:e.providers},r.createElement(t,Object.assign({ref:s},o)))));return s.displayName=o,Y(s,t)};function oe(e){const[t,r]=i(e),[o]=i((()=>({state:t,setState:r,get current(){return this.state},set current(e){this.setState&&this.setState(e)}})));return o.state=t,o.setState=r,o}function se(e){const[t]=i((()=>({state:e,get current(){return this.state},set current(e){throw new Error("Can not set value to this ref of useValueRef!")}})));return t.state=e,t}function ne(){const e=s(Z);return c(((t,r)=>e.get(t,r)),[e])}const ie=(e,t)=>ne()(e,t);function ce(e,t){const[r,o]=i(t);return a((()=>{const t=e.subscribe({next:e=>o(e)});return()=>{t.unsubscribe()}}),[e]),r}function ae(t){if(!(t instanceof e))throw new Error("The useBehaviorState can only use with BehaviorSubject!");const[r,o]=i(t.value);return a((()=>{const e=t.subscribe({next:e=>o(e)});return()=>{e.unsubscribe()}}),[t]),r}function ue(e,r=!1){const[o,s]=i(null);return a((()=>{if(e instanceof t&&r&&e.hasError)return;const o=e.subscribe({error:e=>{s(e)}});return()=>{o.unsubscribe()}}),[e,r]),o}function fe(e,t){const r=se(t);a((()=>{const t=e.subscribe((e=>r.current.next&&r.current.next(e)),(e=>r.current.error&&r.current.error(e)),(()=>r.current.complete&&r.current.complete()));return()=>{t.unsubscribe()}}),[e,r])}export{y as Disposable,d as InjectionToken,h as Injector,b as Service,te as ServiceConsumer,ee as ServiceInjector,f as config,l as debug,p as empty,ae as useBehavior,ne as useGetService,ce as useObservable,ue as useObservableError,oe as useRSRef,ie as useService,fe as useSubscribe,se as useValueRef,re as withInjector};
