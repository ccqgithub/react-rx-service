import{BehaviorSubject as t,Subject as e,of as r,Observable as n,from as i,zip as s,concat as o}from"rxjs";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function c(t){return"function"==typeof t}var h=!1,f={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t);h=t},get useDeprecatedSynchronousErrorHandling(){return h}};function l(t){setTimeout((function(){throw t}),0)}var p={closed:!0,next:function(t){},error:function(t){if(f.useDeprecatedSynchronousErrorHandling)throw t;l(t)},complete:function(){}},d=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function b(t){return null!==t&&"object"==typeof t}var y=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),m=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this,n=r._parentOrParents,i=r._ctorUnsubscribe,s=r._unsubscribe,o=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var u=0;u<n.length;++u){n[u].remove(this)}if(c(s)){i&&(this._unsubscribe=void 0);try{s.call(this)}catch(f){e=f instanceof y?v(f.errors):[f]}}if(d(o)){u=-1;for(var a=o.length;++u<a;){var h=o[u];if(b(h))try{h.unsubscribe()}catch(f){e=e||[],f instanceof y?e=e.concat(v(f.errors)):e.push(f)}}}if(e)throw new y(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=r._parentOrParents;if(null===i)r._parentOrParents=this;else if(i instanceof t){if(i===this)return r;r._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return r;i.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[r]:s.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function v(t){return t.reduce((function(t,e){return t.concat(e instanceof y?e.errors:e)}),[])}var g=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),x=function(t){function e(r,n,i){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=p;break;case 1:if(!r){s.destination=p;break}if("object"==typeof r){r instanceof e?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new _(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new _(s,r,n,i)}return s}return a(e,t),e.prototype[g]=function(){return this},e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(m),_=function(t){function e(e,r,n,i){var s,o=t.call(this)||this;o._parentSubscriber=e;var u=o;return c(r)?s=r:r&&(s=r.next,n=r.error,i=r.complete,r!==p&&(c((u=Object.create(r)).unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(o))),o._context=u,o._next=s,o._error=n,o._complete=i,o}return a(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=f.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):l(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;l(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(r){if(this.unsubscribe(),f.useDeprecatedSynchronousErrorHandling)throw r;l(r)}},e.prototype.__tryOrSetError=function(t,e,r){if(!f.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(n){return f.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=n,t.syncErrorThrown=!0,!0):(l(n),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(x);var w=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function E(t){return t}function S(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return $(t)}function $(t){return 0===t.length?E:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var O=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof x)return t;if(t[g])return t[g]()}return t||e||r?new x(t,e,r):new x(p)}(t,e,r);if(i.add(n?n.call(i,this.source):this.source||f.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),f.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){f.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof x?e:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=j(e))((function(e,n){var i;i=r.subscribe((function(e){try{t(e)}catch(r){n(r),i&&i.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[w]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:$(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=j(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function j(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}function T(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var F=T(),P=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function N(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var A=function(t){if(t&&"function"==typeof t[w])return i=t,function(t){var e=i[w]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(P(t))return n=t,function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()};if(N(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,l),t};if(t&&"function"==typeof t[F])return e=t,function(t){for(var r=e[F]();;){var n=void 0;try{n=r.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,i,s=b(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},I=function(t){function e(e){var r=t.call(this)||this;return r.parent=e,r}return a(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(x),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(x);function D(t,e){if(!e.closed){if(t instanceof O)return t.subscribe(e);var r;try{r=A(t)(e)}catch(n){e.error(n)}return r}}function C(t){return function(e){var r=new k(t),n=e.lift(r);return r.caught=n}}var k=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new R(t,this.selector,this.caught))},t}(),R=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.selector=r,i.caught=n,i}return a(e,t),e.prototype.error=function(e){if(!this.isStopped){var r=void 0;try{r=this.selector(e,this.caught)}catch(s){return void t.prototype.error.call(this,s)}this._unsubscribeAndRecycle();var n=new I(this);this.add(n);var i=D(r,n);i!==n&&this.add(i)}},e}(V);function H(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[w]}(t))return function(t,e){return new O((function(r){var n=new m;return n.add(e.schedule((function(){var i=t[w]();n.add(i.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(N(t))return function(t,e){return new O((function(r){var n=new m;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(P(t))return function(t,e){return new O((function(r){var n=new m,i=0;return n.add(e.schedule((function(){i!==t.length?(r.next(t[i++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}(t,e);if(function(t){return t&&"function"==typeof t[F]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new O((function(r){var n,i=new m;return i.add((function(){n&&"function"==typeof n.return&&n.return()})),i.add(e.schedule((function(){n=t[F](),i.add(e.schedule((function(){if(!r.closed){var t,e;try{var i=n.next();t=i.value,e=i.done}catch(s){return void r.error(s)}e?r.complete():(r.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function Y(t,e){return e?H(t,e):t instanceof O?t:new O(A(t))}function z(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new q(t,e))}}var q=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new U(t,this.project,this.thisArg))},t}(),U=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.project=r,i.count=0,i.thisArg=n||i,i}return a(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(e)},e}(x);function W(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof e?function(n){return n.pipe(W((function(r,n){return Y(t(r,n)).pipe(z((function(t,i){return e(r,t,n,i)})))}),r))}:("number"==typeof e&&(r=e),function(e){return e.lift(new M(t,r))})}var M=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.project,this.concurrent))},t}(),J=function(t){function e(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=r,i.concurrent=n,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return a(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(n){return void this.destination.error(n)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new I(this),r=this.destination;r.add(e);var n=D(t,e);n!==e&&r.add(n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(V);function Z(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),W(E,t)}function B(t){return void 0===t&&(t=null),function(e){return e.lift(new G(t))}}var G=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new K(t,this.defaultValue))},t}(),K=function(t){function e(e,r){var n=t.call(this,e)||this;return n.defaultValue=r,n.isEmpty=!0,n}return a(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(x),L=new O((function(t){return t.complete()}));function Q(t){return t?function(t){return new O((function(e){return t.schedule((function(){return e.complete()}))}))}(t):L}var X=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}();function tt(t){return function(e){return 0===t?Q():e.lift(new et(t))}}var et=function(){function t(t){if(this.total=t,this.total<0)throw new X}return t.prototype.call=function(t,e){return e.subscribe(new rt(t,this.total))},t}(),rt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.total=r,n.ring=new Array,n.count=0,n}return a(e,t),e.prototype._next=function(t){var e=this.ring,r=this.total,n=this.count++;e.length<r?e.push(t):e[n%r]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,i=0;i<r;i++){var s=e++%r;t.next(n[s])}t.complete()},e}(x);function nt(t,e){var r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new it(t,e,r))}}var it=function(){function t(t,e,r){void 0===r&&(r=!1),this.accumulator=t,this.seed=e,this.hasSeed=r}return t.prototype.call=function(t,e){return e.subscribe(new st(t,this.accumulator,this.seed,this.hasSeed))},t}(),st=function(t){function e(e,r,n,i){var s=t.call(this,e)||this;return s.accumulator=r,s._seed=n,s.hasSeed=i,s.index=0,s}return a(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.accumulator(this.seed,t,r)}catch(n){this.destination.error(n)}this.seed=e,this.destination.next(e)},e}(x);var ot=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new ut(t,this.total))},t}(),ut=function(t){function e(e,r){var n=t.call(this,e)||this;return n.total=r,n.count=0,n}return a(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(x);function at(t,e){return"function"==typeof e?function(r){return r.pipe(at((function(r,n){return Y(t(r,n)).pipe(z((function(t,i){return e(r,t,n,i)})))})))}:function(e){return e.lift(new ct(t))}}var ct=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new ht(t,this.project))},t}(),ht=function(t){function e(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return a(e,t),e.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(n){return void this.destination.error(n)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var r=new I(this),n=this.destination;n.add(r),this.innerSubscription=D(t,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(V);function ft(){}function lt(t,e,r){return function(n){return n.lift(new pt(t,e,r))}}var pt=function(){function t(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}return t.prototype.call=function(t,e){return e.subscribe(new dt(t,this.nextOrObserver,this.error,this.complete))},t}(),dt=function(t){function e(e,r,n,i){var s=t.call(this,e)||this;return s._tapNext=ft,s._tapError=ft,s._tapComplete=ft,s._tapError=n||ft,s._tapComplete=i||ft,c(r)?(s._context=s,s._tapNext=r):r&&(s._context=r,s._tapNext=r.next||ft,s._tapError=r.error||ft,s._tapComplete=r.complete||ft),s}return a(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(x);const bt=/%[sdj%]/g;function yt(t,...e){let r=0;const n=e.length;if("function"==typeof t)return t(...e);if("string"==typeof t){return t.replace(bt,(t=>{if("%%"===t)return"%";if(r>=n)return t;switch(t){case"%s":case"%d":return e[r++];case"%j":try{return JSON.stringify(e[r++])}catch(i){return"[Circular]"}default:return t}}))}return t}function mt(t,e,r,n){if(!t.required)return[];const i=[];return function(t,e){return null==t||!("array"!==e||!Array.isArray(t)||t.length)||!(!function(t){return"string"===t||"url"===t||"hex"===t||"email"===t||"date"===t||"pattern"===t}(e)||"string"!=typeof t||t)}(e,t.type)&&i.push(yt(n.messages.required,n.fullField)),i}const vt={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},gt={integer:t=>gt.number(t)&&parseInt(t,10)===t,float:t=>gt.number(t)&&!gt.integer(t),array:t=>Array.isArray(t),regexp(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch(e){return!1}},date:t=>"function"==typeof t.getTime&&"function"==typeof t.getMonth&&"function"==typeof t.getYear&&!isNaN(t.getTime()),number:t=>!isNaN(t)&&"number"==typeof t,object:t=>"object"==typeof t&&!gt.array(t),method:t=>"function"==typeof t,email:t=>"string"==typeof t&&!!t.match(vt.email)&&t.length<255,url:t=>"string"==typeof t&&!!t.match(vt.url),hex:t=>"string"==typeof t&&!!t.match(vt.hex)};var xt={required:mt,whitespace:function(t,e,r,n){if(!t.notWhitespace)return[];const i=[];return(/^\s+$/.test(e)||""===e)&&i.push(yt(n.messages.notWhitespace,n.fullField)),i},type:function(t,e,r,n){const i=[],s=t.type;return s?null==e?t.required?mt(t,e,0,n):i:(["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(s)>-1?gt[s](e)||i.push(yt(n.messages.types[s],n.fullField,s)):s&&typeof e!==s&&i.push(yt(n.messages.types[s],n.fullField,s)),i):i},range:function(t,e,r,n){const i=[],s="number"==typeof t.len,o="number"==typeof t.min,u="number"==typeof t.max;if(!s&&!o&&!u)return i;const a=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;let c=e,h=null;const f="number"==typeof e,l="string"==typeof e,p=Array.isArray(e);return f?h="number":l?h="string":p&&(h="array"),h?(p&&(c=e.length),l&&(c=e.replace(a,"_").length),s?c!==t.len&&i.push(yt(n.messages[h].len,n.fullField,t.len)):o&&!u&&c<t.min?i.push(yt(n.messages[h].min,n.fullField,t.min)):u&&!o&&c>t.max?i.push(yt(n.messages[h].max,n.fullField,t.max)):o&&u&&(c<t.min||c>t.max)&&i.push(yt(n.messages[h].range,n.fullField,t.min,t.max)),i):i},enum:function(t,e,r,n){if(!t.enum||!Array.isArray(t.enum))return[];const i=[];return-1===t.enum.indexOf(e)&&i.push(yt(n.messages.enum,n.fullField,t.enum.join(", "))),i},pattern:function(t,e,r,n){if(!t.pattern)return[];const i=[];if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||i.push(yt(n.messages.pattern.mismatch,n.fullField,e,t.pattern));else if("string"==typeof t.pattern){new RegExp(t.pattern).test(e)||i.push(yt(n.messages.pattern.mismatch,n.fullField,e,t.pattern))}return i}};const _t={default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",notWhitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{match:"%s value %s does not match pattern %s"},clone(){const t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}};class wt extends Error{constructor(t,e=!1){super(t),this.self=e}}class Et{constructor(r,n,i){this.shouldValidate=(t,e)=>t!==e,this.fields={},this.validating$$=new t(!1),this.errors$$=new t([]),this.validate$=new e,this.waiting=null,this.disposers=[];const{rules:s=[]}=r,{name:o,namePath:u,form:a,index:c}=i;if(void 0===o)throw new Error("Need a name for RSField!");this.rules=s,this.namePath=u,this.index=c,this.form=a,this.value$$=new t(n),this.updateFields(r,n);const h=this.validate$.pipe(lt((()=>{this.validating$$.next(!0);const t={};t.promise=new Promise((e=>{t.resolve=e})),this.waiting=t})),at((()=>this.validateAll())),lt((t=>{this.validating$$.next(!1),this.errors$$.next(t),this.waiting&&this.waiting.resolve(t)})),C(((t,e)=>(console.log(t),e)))).subscribe();this.disposers.push((()=>{h.unsubscribe()}));const f=this.errors$$.pipe((l=1,function(t){return t.lift(new ot(l))})).subscribe((()=>{this.form.updateErrors()}));var l;this.disposers.push((()=>{f.unsubscribe()})),this.form.dirty&&this.validate$.next()}get value(){return this.value$$.value}get errors(){return this.errors$$.value}get fieldErrors(){const{fields:t}=this,e={};return Object.keys(t).forEach((r=>{e[t[r].index]={errors:t[r].errors,fields:t[r].fieldErrors}})),e}get validating(){return this.validating$$.value}updateFields(t,e){const r={};Array.isArray(t.fields)?t.fields.forEach(((t,e)=>{if(!t.name)throw new Error("Array field need a name property!");r[t.name]={...t,index:`${e}`}})):"object"==typeof t.fields&&Object.keys(t.fields).forEach((e=>{r[e]={...t.fields[e],name:e,index:e}}));const n=Object.keys(this.fields),i=Object.keys(r);n.forEach((t=>{-1===i.indexOf(t)&&(this.fields[t].dispose(),delete this.fields[t])})),i.forEach((t=>{-1===n.indexOf(t)?this.fields[t]=new Et(r[t],this.getSubValue(e,r[t].index),{form:this.form,name:t,namePath:this.namePath?`${this.namePath}.${r[t].index}`:r[t].index,index:r[t].index}):this.fields[t].update(r[t],this.getSubValue(e,r[t].index))}))}update(t,e){const{rules:r=[]}=t;this.rules=r;const n=this.shouldValidate(e,this.value);this.value$$.next(e),this.updateFields(t,e),n&&this.validate$.next()}validateRules(){const{value:t,rules:e,form:n}=this,i=e.map((e=>this.validateRule(e,t,n.data)));return r(...i).pipe(Z(1),function(t,e){return arguments.length>=2?function(r){return S(nt(t,e),tt(1),B(e))(r)}:function(e){return S(nt((function(e,r,n){return t(e,r,n+1)})),tt(1))(e)}}(((t,e)=>t.concat(...e)),[]),z((t=>t.map((t=>new wt(t,!0))))))}validateRule(t,e,s){const o=[];Object.keys(xt).forEach((r=>{o.push(...xt[r](t,e,s,{messages:_t,fullField:this.namePath}))}));let u=null;if(t.validator){const o=t.validator(t,e,s,{messages:_t,fullField:this.namePath});u=o instanceof n?o:o instanceof Promise?i(o):r(o)}return u?u.pipe(z((t=>o.concat(...t))),z((e=>t.message?[t.message]:e))):r(t.message?[t.message]:o)}validateFields(){const{fields:t}=this,e=Object.keys(t).map((e=>t[e].validateWait()));return s(...e).pipe(z((t=>t.reduce(((t,e)=>[...t,...e]),[]))))}validateAll(){return o(this.validateRules(),this.validateFields())}validateWait(){return this.waiting?i(this.waiting.promise):r([])}validate(){return this.waiting||this.validate$.next(),this.waiting.promise}getSubValue(t,e){if("object"==typeof t)return t[e]}dispose(){this.disposers.forEach((t=>{t()})),this.disposers=[]}}class St{constructor(r,n){this.disposers=[],this.waiting=null,this.dirty=!1,this.validating$$=new t(!1),this.errors$$=new t([]),this.fields$$=new t({}),this.validate$=new e,this.schema=r,this.data$$=new t(n),this.form=new Et(this.getFormFieldSchema(),n,{form:this,name:"",namePath:"",index:""});const s=this.validate$.pipe(lt((()=>{this.dirty=!0,this.validating$$.next(!0);const t={};t.promise=new Promise((e=>{t.resolve=e})),this.waiting=t})),at((()=>{const t=this.form.validate();return i(t)})),lt((t=>{this.validating$$.next(!1),this.errors$$.next(t),this.waiting&&this.waiting.resolve(t)})),C(((t,e)=>(console.log(t),e)))).subscribe();this.disposers.push((()=>{s.unsubscribe()}))}get data(){return this.data$$.value}get validating(){return this.validating$$.value}get errors(){return this.errors$$.value}get fields(){return this.fields$$.value}getFormFieldSchema(){const{schema:t}=this;return{rules:[],fields:"function"==typeof t?t(this.data):t}}updateErrors(){this.errors$$.next(this.form.errors),this.fields$$.next(this.form.fieldErrors)}update(t){this.data$$.next({...this.data,...t}),this.form.update(this.getFormFieldSchema(),this.data)}validate(){return this.validating||this.validate$.next(),this.waiting.promise}dispose(){this.disposers.forEach((t=>{t()}))}}export{Et as Field,St as Form,_t as messages};
